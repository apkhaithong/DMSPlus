<div class="row" id="spy2">
    <!-- Chart with filter Widget -->
    <div class="col-md-12 admin-grid">
        <div class="panel" id="p2">
            <div class="panel-heading">
                <span class="panel-icon"><span class="glyphicons glyphicons-car"></span></span>
                <span class="panel-title">สอบถามข้อมูลการขาย</span>
                <span class="panel-controls">
                    <a href="#" class="panel-control-loader"></a>
                    <a href="#" class="panel-control-remove"></a>
                    <a href="#" class="panel-control-collapse"></a>
                    <a href="#" class="panel-control-fullscreen"></a>
                </span>
            </div>
            <div class="panel-body">
                <div class="p15 pt5 mt15">
                    <div id="jqxLoader"></div>
                    <div class="row">
                        <div class="col-md-3">
                            <form class="form-horizontal" role="form">
                                <div class="form-group">
                                    <label class="col-sm-4 control-label" for="fdate">จาก วันที่</label>
                                    <div class="col-sm-8">
                                        <div class="bs-component">
                                            <div id="fdate"></div>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div class="col-md-3">
                            <form class="form-horizontal" role="form">
                                <div class="form-group">
                                    <label class="col-sm-4 control-label" for="tdate">ถึง วันที่</label>
                                    <div class="col-sm-8">
                                        <div class="bs-component">
                                            <div id="tdate"></div>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div class="col-md-3">
                        </div>
                        <div class="col-md-3">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-3">
                            <form class="form-horizontal" role="form">
                                <div class="form-group">
                                    <label class="col-sm-4 control-label" for="locatcd">สาขา</label>
                                    <div class="col-sm-8">
                                        <div class="bs-component">
                                            <div id="locatcd" class="input-button">
                                                <input type="text" id="v-locatcd" />
                                                <div id="searchInvlocat"><img alt="search" width="20" height="20" src="/images/search_lg.png" /></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-4 control-label" for="modelcode">รุ่นสินค้า</label>
                                    <div class="col-sm-8">
                                        <div class="bs-component">
                                            <div id="modelcode" class="input-button">
                                                <input type="text" id="v-modelcode" />
                                                <div id="searchSetmodel"><img alt="search" width="20" height="20" src="/images/search_lg.png" /></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-4 control-label" for="parkcode">สถานที่จอด</label>
                                    <div class="col-sm-8">
                                        <div class="bs-component">
                                            <div id="parkcode" class="input-button">
                                                <input type="text" id="v-parkcode" />
                                                <div id="searchInvparking"><img alt="search" width="20" height="20" src="/images/search_lg.png" /></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div class="col-md-3">
                            <form class="form-horizontal" role="form">
                                <div class="form-group">
                                    <label class="col-sm-4 control-label" for="groupcode">กลุ่มสินค้า</label>
                                    <div class="col-sm-8">
                                        <div class="bs-component">
                                            <div id="groupcode" class="input-button">
                                                <input type="text" id="v-groupcode" />
                                                <div id="searchSetgroup"><img alt="search" width="20" height="20" src="/images/search_lg.png" /></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-4 control-label" for="baabcode">แบบสินค้า</label>
                                    <div class="col-sm-8">
                                        <div class="bs-component">
                                            <div id="baabcode" class="input-button">
                                                <input type="text" id="v-baabcode" />
                                                <div id="searchSetbaab"><img alt="search" width="20" height="20" src="/images/search_lg.png" /></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-4 control-label" for="statuscode">สถานะสินค้า</label>
                                    <div class="col-sm-8">
                                        <div class="bs-component pr5">
                                            <div id="statuscode"></div>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div class="col-md-3">
                            <form class="form-horizontal" role="form">
                                <div class="form-group">
                                    <label class="col-sm-4 control-label" for="typecode">ยี่ห้อสินค้า</label>
                                    <div class="col-sm-8">
                                        <div class="bs-component">
                                            <div id="typecode" class="input-button">
                                                <input type="text" id="v-typecode" />
                                                <div id="searchSettype"><img alt="search" width="20" height="20" src="/images/search_lg.png" /></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-4 control-label" for="colorcode">สีสินค้า</label>
                                    <div class="col-sm-8">
                                        <div class="bs-component">
                                            <div id="colorcode" class="input-button">
                                                <input type="text" id="v-colorcode" />
                                                <div id="searchSetcolor"><img alt="search" width="20" height="20" src="/images/search_lg.png" /></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                </div>
                            </form>
                        </div>
                        <div class="col-md-3">
                            <button type="button" class="btn btn-rounded btn-dark btn-block" id="btnQuery">
                                <i class="glyphicons glyphicons-inbox_in"></i>&nbsp;
                                แสดงข้อมูล
                            </button>
                        </div>
                    </div>
                    <hr class="short alt">
                    <div class="row">
                        <div class="col-md-12">
                            <div id="gridSaleorder"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- end: .col-md-12.admin-grid -->
</div>
<!-- end: .row -->
<script type="text/javascript">
    $(document).ready(function () {
        $('.admin-panels').adminpanel({
            grid: '.admin-grid',
            callback: function () {
                bootbox.confirm('<h3>A Custom Callback!</h3>', function () {});
            },
            onFinish: function () {
                $('.admin-panels').addClass('animated fadeIn').removeClass('fade-onload');
                demoHighCharts.init();
            },
            onSave: function () {
                $(window).trigger('resize');
            }
        });

        $.jqx.theme = "bootstrap";

        var sourceInvlocat = {
            async: false,
            datatype: "json",
            datafields: [{
                    name: 'LOCATCD'
                },
                {
                    name: 'LOCATNM'
                }
            ],
            url: "invlocat"
        };
        var sourceStatus = [{
                text: "ทั้งหมด",
                value: '%'
            },
            {
                text: "รถใหม่",
                value: 'N%'
            },
            {
                text: "รถเก่า",
                value: 'O%'
            }
        ];
        var emptyStock = [];
        var sourceSaleorder = {
            datatype: "json",
            datafields: [{
                    name: 'LOCAT',
                    type: 'string'
                },
                {
                    name: 'SDATE',
                    type: 'date'
                },
                {
                    name: 'TSALE',
                    type: 'string'
                },
                {
                    name: 'CONTNO',
                    type: 'string'
                },
                {
                    name: 'CUSTNAME',
                    type: 'string'
                },
                {
                    name: 'STRNO',
                    type: 'string'
                },
                {
                    name: 'TYPECOD',
                    type: 'string'
                },
                {
                    name: 'MODELCOD',
                    type: 'string'
                },
                {
                    name: 'BAABCOD',
                    type: 'string'
                },
                {
                    name: 'COLORCOD',
                    type: 'string'
                },
                {
                    name: 'KEYINPRC',
                    type: 'float'
                },
                {
                    name: 'TDAWN',
                    type: 'float'
                },
                {
                    name: 'PAYRES',
                    type: 'float'
                },
                {
                    name: 'PAYDAWN',
                    type: 'float'
                },
                {
                    name: 'SMPAY',
                    type: 'float'
                },
                {
                    name: 'FINCOD',
                    type: 'string'
                }
            ],
            localdata: emptyStock
        };
        // create Data Adapter
        var dataInvlocat = new $.jqx.dataAdapter(sourceInvlocat);
        var dataSaleorder = new $.jqx.dataAdapter(sourceSaleorder);
        // create jqxInput widget.
        $("#fdate").jqxDateTimeInput({
            height: 25,
            width: '100%',
            culture: 'en-US'
        });
        $("#tdate").jqxDateTimeInput({
            height: 25,
            width: '100%',
            culture: 'en-US'
        });
        $('#locatcd').jqxInput({
            height: 25,
            width: '100%'
        });
        $('#locatcd').val($.session.get('locatcd'));
        $('#groupcode').jqxInput({
            height: 25,
            width: '100%'
        });
        $('#typecode').jqxInput({
            height: 25,
            width: '100%'
        });
        $('#modelcode').jqxInput({
            height: 25,
            width: '100%'
        });
        $('#baabcode').jqxInput({
            height: 25,
            width: '100%'
        });
        $('#colorcode').jqxInput({
            height: 25,
            width: '100%'
        });
        $('#parkcode').jqxInput({
            height: 25,
            width: '100%'
        });
        $("#statuscode").jqxDropDownList({
            height: 25,
            width: '100%',
            source: sourceStatus,
            displayMember: 'text',
            valueMember: 'value',
            dropDownHeight: 80,
            selectedIndex: 0
        });
        $("#jqxLoader").jqxLoader({ width: 100, height: 60, imagePosition: 'top' });
        // create jqxGrid widget.
        $("#gridSaleorder").jqxGrid({
            width: '100%',
            height: 570,
            source: dataSaleorder,
            sortable: true,
            columnsresize: true,
            filterable: true,
            showfilterrow: true,
            showaggregates: true,
            showstatusbar: true,
            statusbarheight: 25,
            pageable: false,
            pagesize: 20,
            pagermode: "simple",
            columns: [{
                    text: 'ลำดับ',
                    sortable: false,
                    filterable: false,
                    editable: false,
                    groupable: false,
                    draggable: false,
                    resizable: false,
                    align: 'center',
                    cellsalign: 'center',
                    datafield: '',
                    columntype: 'number',
                    width: 40,
                    exportable: false,
                    cellsrenderer: function (row, column, value) {
                        return "<div style='margin:4px;'>" + (value + 1) + "</div>";
                    },
                    aggregates: ['count'],
                    aggregatesrenderer: function (aggregates) {
                        var renderstring = "";
                        $.each(aggregates, function (key, value) {
                            renderstring +=
                                '<div style="position: relative; margin: 4px; overflow: hidden; font-weight: bold;">' +
                                value + '</div>';
                        });
                        return renderstring;
                    }
                },
                {
                    text: 'สาขา',
                    datafield: 'LOCAT',
                    width: 60,
                    align: 'center',
                    filtertype: 'checkedlist'
                },
                {
                    text: 'การขาย',
                    datafield: 'TSALE',
                    width: 70,
                    align: 'center',
                    filtertype: 'checkedlist'
                },
                {
                    text: 'เลขที่สัญญา',
                    datafield: 'CONTNO',
                    width: 100,
                    align: 'center',
                    filtertype: 'checkedlist'
                },
                {
                    text: 'ชื่อลูกค้า',
                    datafield: 'CUSTNAME',
                    width: 150,
                    align: 'center',
                    filtertype: 'checkedlist'
                },
                {
                    text: 'วันที่ขาย',
                    datafield: 'SDATE',
                    width: 80,
                    align: 'center',
                    columntype: 'datetimeinput',
                    cellsformat: 'dd/MM/yyyy',
                    filtertype: 'range'
                },
                {
                    text: 'เลขตัวถัง',
                    datafield: 'STRNO',
                    width: 160,
                    align: 'center',
                    filtertype: 'checkedlist'
                },
                {
                    text: 'ยี่ห้อ',
                    datafield: 'TYPECOD',
                    width: 80,
                    align: 'center',
                    filtertype: 'checkedlist'
                },
                {
                    text: 'รุ่น',
                    datafield: 'MODELCOD',
                    width: 80,
                    align: 'center',
                    filtertype: 'checkedlist'
                },
                {
                    text: 'แบบ',
                    datafield: 'BAABCOD',
                    width: 160,
                    align: 'center',
                    filtertype: 'checkedlist'
                },
                {
                    text: 'สี',
                    datafield: 'COLORCOD',
                    width: 150,
                    align: 'center',
                    filtertype: 'checkedlist'
                },
                {
                    text: 'ราคาขาย',
                    datafield: 'KEYINPRC',
                    width: 100,
                    align: 'center',
                    cellsalign: 'right',
                    cellsformat: 'd2',
                    filtertype: 'number',
                    aggregates: ['sum'],
                    aggregatesrenderer: function (aggregates) {
                        var renderstring = "";
                        $.each(aggregates, function (key, value) {
                            renderstring +=
                                '<div style="position: relative; margin: 4px; overflow: hidden; font-weight: bold;">' +
                                value + '</div>';
                        });
                        return renderstring;
                    }
                },
                {
                    text: 'เงินดาวน์',
                    datafield: 'TDAWN',
                    width: 80,
                    align: 'center',
                    cellsalign: 'right',
                    cellsformat: 'd2',
                    filtertype: 'number',
                    aggregates: ['sum'],
                    aggregatesrenderer: function (aggregates) {
                        var renderstring = "";
                        $.each(aggregates, function (key, value) {
                            renderstring +=
                                '<div style="position: relative; margin: 4px; overflow: hidden; font-weight: bold;">' +
                                value + '</div>';
                        });
                        return renderstring;
                    }
                },
                {
                    text: 'เงินจอง',
                    datafield: 'PAYRES',
                    width: 100,
                    align: 'center',
                    cellsalign: 'right',
                    cellsformat: 'd2',
                    filtertype: 'number',
                    aggregates: ['sum'],
                    aggregatesrenderer: function (aggregates) {
                        var renderstring = "";
                        $.each(aggregates, function (key, value) {
                            renderstring +=
                                '<div style="position: relative; margin: 4px; overflow: hidden; font-weight: bold;">' +
                                value + '</div>';
                        });
                        return renderstring;
                    }
                },
                {
                    text: 'ชำระดาวน์',
                    datafield: 'PAYDAWN',
                    width: 100,
                    align: 'center',
                    cellsalign: 'right',
                    cellsformat: 'd2',
                    filtertype: 'number',
                    aggregates: ['sum'],
                    aggregatesrenderer: function (aggregates) {
                        var renderstring = "";
                        $.each(aggregates, function (key, value) {
                            renderstring +=
                                '<div style="position: relative; margin: 4px; overflow: hidden; font-weight: bold;">' +
                                value + '</div>';
                        });
                        return renderstring;
                    }
                },
                {
                    text: 'ชำระแล้ว',
                    datafield: 'SMPAY',
                    width: 100,
                    align: 'center',
                    cellsalign: 'right',
                    cellsformat: 'd2',
                    filtertype: 'number',
                    aggregates: ['sum'],
                    aggregatesrenderer: function (aggregates) {
                        var renderstring = "";
                        $.each(aggregates, function (key, value) {
                            renderstring +=
                                '<div style="position: relative; margin: 4px; overflow: hidden; font-weight: bold;">' +
                                value + '</div>';
                        });
                        return renderstring;
                    }
                },
                {
                    text: 'บริษัทไฟแนนซ์',
                    datafield: 'FINCOD',
                    width: 150,
                    align: 'center',
                    filtertype: 'checkedlist'
                }
            ]
        });
        // On Click
        $("#btnQuery").off().on('click', function () {
            $("#jqxLoader").jqxLoader('open');
            var at1Date = $("#fdate").jqxDateTimeInput('getDate');
            var at2Date = $("#tdate").jqxDateTimeInput('getDate');
            var currentCulture = Globalize.cultures['en-US'];
            var localizationObject = currentCulture.calendar;
            var fdate = $.jqx.dataFormat.formatdate(at1Date, "yyyy-MM-dd", localizationObject);
            var tdate = $.jqx.dataFormat.formatdate(at2Date, "yyyy-MM-dd", localizationObject);
            
            // Get Data
            $.ajax({
                async: true,
                method: 'GET',
                dataType: 'json',
                url: "sqltext",
                data: {
                    sql: "SELECT A.*,TRIM(B.SNAM)||TRIM(B.NAME1)||' '||TRIM(B.NAME2) AS CUSTNAME FROM VWSALE A LEFT JOIN CUSTMAST B ON(A.CUSCOD=B.CUSCOD) WHERE A.SDATE BETWEEN '" + fdate +"' AND '" + tdate +
                        "'   AND (A.TYPECOD LIKE '" + $("#typecode").val() +
                        "%') AND (A.MODELCOD LIKE '" + $("#modelcode").val() +
                        "%') AND (A.BAABCOD LIKE '" + $("#baabcode").val() +
                        "%') AND (A.COLORCOD LIKE '" + $("#colorcode").val() +
                        "%') AND (A.LOCAT LIKE '" + $("#locatcd").val() +
                        "%') AND (A.LOCSALE LIKE '" + $("#parkcode").val() +
                        "%' OR A.LOCSALE IS NULL) AND (A.GCODE LIKE '" + $("#groupcode").val() +
                        "%') AND A.STAT LIKE '" + $("#statuscode").val() + "' "
                },
                success: function (data) {
                    sourceSaleorder.localdata = data;
                    $("#gridSaleorder").jqxGrid('updatebounddata');
                    $("#jqxLoader").jqxLoader('close');
                }
            });
        });
        // Search
        $("#searchInvlocat").off().on('click', function () {
            searchAll('invlocat', 'locatcd');
        });
        $("#searchSetgroup").off().on('click', function () {
            searchAll('setgroup', 'groupcode');
        });
        $("#searchSettype").off().on('click', function () {
            searchAll('settype', 'typecode');
        });
        $("#searchSetmodel").off().on('click', function () {
            searchAll('setmodel', 'modelcode');
        });
        $("#searchSetbaab").off().on('click', function () {
            searchAll('setbaab', 'baabcode');
        });
        $("#searchSetcolor").off().on('click', function () {
            searchAll('setcolor', 'colorcode');
        });
        $("#searchInvparking").off().on('click', function () {
            xlocat = $('#locatcd').val();
            if (xlocat === "") {
                ShowMessage("กรุณาระบุรหัสสาขาก่อน!", "info");
            } else {
                searchAll('invparking', 'parkcode');
            }
        });
    });
</script>